FROM node:16-alpine

ARG NEDB_PERSISTENCE_DIRECTORY
ARG NPM_REGISTRY_AUTH_TOKEN

ENV NEDB_PERSISTENCE_DIRECTORY=$NEDB_PERSISTENCE_DIRECTORY
ENV NPM_REGISTRY_AUTH_TOKEN=$NPM_REGISTRY_AUTH_TOKEN

WORKDIR /app

COPY server/package.json .
COPY .npmrc .
RUN yarn && yarn global add nodemon

COPY server .
RUN yarn build

EXPOSE 3000
CMD yarn start
